class MationHTML{constructor(){this.rules=[]}#a=null;#b=[];#c=[];set noRuleFallback(e){if("function"!=typeof e)throw Error("Callback must be a function.");this.#a=e}set ignoreSelectors(e){if(!Array.isArray(e))throw Error("Selectors must be an array of strings.");for(let t of e){if("string"!=typeof t)throw Error("Selector must be a string.");this.#b.includes(t)||this.#b.push(t)}}registerPlaceholder(e){let t=Array.isArray(e)?e:[e];for(let r of t){if(!r?.from||!r?.to)throw Error("Invalid placeholder object.");this.#c.push({from:r.from,to:r.to})}}register(e){let t=Array.isArray(e)?e:[e];t.forEach(e=>{this.#d(e),this.rules.push(e)})}convert(e,t=!0,r=!0){if("string"!=typeof e)throw Error("Input must be a string.");let o=new DOMParser,l=o.parseFromString(e,"text/html"),s=t?l.body:l.documentElement,n=this.#e(s,0,r);for(let i of this.#c)n=n.replaceAll(i.from,i.to);return n.trim()}#e(e,t=0,r=!0){return e.nodeType===Node.TEXT_NODE?e.parentElement?.tagName==="PRE"?e.textContent:r?e.textContent.replace(/\s+/g," "):e.textContent:e.nodeType===Node.ELEMENT_NODE?this.#b.some(t=>e.matches(t))?"":this.#f(e,t,r):""}#g(o,l,s){let n="",i=Array.from(o.childNodes);for(let a of i)n+=this.#e(a,l+1,s);return n}#f(c,f,u){let h=this.rules.filter(e=>c.matches(e.selector)),p={};for(let m of c.attributes)p[m.name]=m.value;let d=e=>this.#e(e||c,f,u),g=()=>this.#g(c,f,u);if(h.length>0){let b=null;for(let y of h)if(y.format){let E={node:c,dataset:p,depth:f,convert:d,get content(){return null!==b?b:g()}},w=y.format(E);if(void 0===w)throw Error(`Rule for "${y.selector}" returned undefined.`);b=w}else if(y.to){let v=null!==b?b:g();b=y.to.replace(/{dataset\.([\w-]+)}/g,(e,t)=>p[t]||"").replace(/{content}/g,v).replace(/{spacing}/g,"")}return b}if(this.#a){let N=this.#a({node:c,dataset:p,depth:f,convert:d,get content(){return g()}});if(void 0!==N)return N;throw Error("Fallback must return content.")}return g()}#d($){if("object"!=typeof $||!$.selector||!($.to||$.format))throw Error("Invalid rule structure.")}}