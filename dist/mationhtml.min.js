class MationHTML{constructor(){this.rules=[]}#a=null;#b=[];#c=[];set noRuleFallback(e){if("function"!=typeof e)throw Error("Given callback should be a function.");this.#a=e}set ignoreSelectors(e){if(!Array.isArray(e))throw Error("Given tags should be an array of strings.");for(let t of e){if("string"!=typeof t)throw Error("Each selector should be a string.");this.#b.includes(t)||this.#b.push(t)}}registerPlaceholder(e){let t=Array.isArray(e)?e:[e];for(let o of t){if(!o||"object"!=typeof o||"string"!=typeof o.from||"string"!=typeof o.to)throw Error("Each placeholder must be an object with 'from' and 'to' as strings.");this.#c.push({from:o.from,to:o.to})}}register(e){if(Array.isArray(e)){for(let t of e)this.#d(t);this.rules.push(...e)}else this.#d(e),this.rules.push(e)}convert(e,t=!0){if("string"!=typeof e)throw Error("Input must be a string.");let o=new DOMParser,r=o.parseFromString(e,"text/html"),l=t?r.body:r.documentElement,s=this.#e(l);for(let n of this.#c)s=s.replaceAll(n.from,n.to);return s}#e(e,t=0){let o="";for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)o+=r.textContent;else if(r.nodeType===Node.ELEMENT_NODE){if(this.#b.some(e=>r.matches(e)))continue;o+=this.#f(r,t+1)}return o}#f(l,s){let n=this.rules.filter(e=>l.matches(e.selector)),i=this.#e(l,s),a={};for(let f of l.attributes)a[f.name]=f.value;if(n.length>0){let c=i;for(let h of n)if(h.format){let u=h.format({node:l,content:c,dataset:a,depth:s});if(void 0!==u)c=u;else throw Error(`The format handler for the selector "${h.selector}" must return content.`)}else c=h.to.replace(/{dataset\.([\w-]+)}/g,(e,t)=>a[t]||"").replace(/{content}/g,c).replace(/{spacing}/g,"");return c}if(this.#a&&"function"==typeof this.#a){let d=this.#a({node:l,content:i,dataset:a,depth:s});if(void 0!==d)return d;throw Error("The noRuleFallback function must return content")}return console.warn(`No rule found for element: <${l.tagName}>`),i}#d(m){if("object"!=typeof m||!m.selector||!(m.to||m.format))throw Error('Invalid rule: Must have a "selector" and a "format" or "to".')}}